<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MovieCaster - Main</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="../static/css/main.css" />
    <link rel="stylesheet" href="../static/css/header.css" />
    <link rel="stylesheet" href="../static/css/footer.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <header>
      <section class="logo-section">
        <div class="logo" onclick="location.href='/'">
          <img src="/static/img/logo.png" alt="logo" width="150px" height="100px" />
        </div>
        <div class="icon-group">
          <a href="/search"><i class="fa-solid fa-magnifying-glass search-icon"></i></a>
          <% if ( user ) { %>
          <a id="logoutButton" href="/signout">
            <div class="user-status">LOGOUT</div>
          </a>
          <% } else { %>
          <a id="loginButton" href="/signin">
            <div class="user-status">LOGIN</div>
          </a>
          <% } %>
          <a href="/mypage"><i class="fa-solid fa-user user-icon"></i></a>
        </div>
      </section>
      <section class="box-office-section">
        <div class="box-office__film">
          <img src="../static/img/filmroll.jpg" alt="" width="1500px" height="280px" />
          <span class="box-office-text">Box Office</span>
          <div class="box-office-swiper">
            <ul class="box-office-slider">
              <% for (let i = 0; i < (data.sec1.length)/2; i++) { %>
              <div class="box-office-rank"><%= i + 1 %></div>
              <li class="box-office-poster"><img src="<%= `https://image.tmdb.org/t/p/w154${data.sec1[i].poster_path}` %>" /></li>
              <% } %>
            </ul>
          </div>
        </div>
      </section>
    </header>

    <div class="main-section">
      <section class="best-section">
        <div class="best-section__title section__title">
          <i class="bi bi-brightness-high sun-icon"></i>
          <h4>해가 쨍쨍! 평점 높은 영화</h4>
        </div>
        <div class="swiper best-section-swiper">
          <div class="swiper-wrapper best-movie__list section__list">
            <!-- length -->
            <% for (let i = 0; i<data.sec2.length; i++) { %>
            <div class="swiper-slide best-movie__body section__body">
              <div class="best-movie__poster-body section__poster-body">
                <ul>
                  <li>
                    <a href="">
                      <div class="best-movie__poster"><img src="<%= `https://image.tmdb.org/t/p/w200${data.sec2[i]['CommentMovie.poster_path']}` %>" alt=""  /></div>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="best-movie__comment">
                <ul>
                  <li class="text-sm">

                    <span class="nickname-sm"><%= data.sec2[i].CommentUser.nickname %></span>
                    <i class="fa-solid fa-heart heart-icon" onclick="clickLike(this)"></i>
                  </li>
                  <li class="movie-title text-sm">
                    <strong><span><%= data.sec2[i]['CommentMovie.title'] %></span></strong>
                  </li>
                  <li class="comment-sm text-sm">
                    <span><%= data.sec2[i].description %></span>
                  </li>
                </ul>
              </div>
            </div>
            <% } %>
          </div>
        </div>
        <div class="arrow-box swiper-button-prev">
          <i class="fa-solid fa-chevron-left arrow-icon left-arrow"></i>
        </div>
        <div class="arrow-box swiper-button-next">
          <i class="fa-solid fa-chevron-right arrow-icon right-arrow"></i>
        </div>
      </section>

      <section class="md-section">
        <div class="md-section__title section__title">
          <i class="bi bi-brightness-high sun-icon"></i>
          <i class="fa-solid fa-cloud cloud-icon"></i>
          <h4>호불호 확실한 영화</h4>
        </div>
        <div class="swiper md-section-swiper">
          <div class="swiper-wrapper md-movie__list section__list">
            <!-- length -->
            <% for (let i=0; i<10; i++) { %>
            <div class="swiper-slide md-movie__body section__body">
              <div class="md-movie__poster-body section__poster-body">
                <ul>
                  <li>
                    <a href="">
                      <div class="md-movie__poster"><img src="<%= `https://image.tmdb.org/t/p/w200${data.sec3[i]['CommentMovie.poster_path']}` %>" alt="" /></div>
                    </a>
                  </li>
                </ul>
              </div>
              <div class="md-movie__info">
                <ul>
                  <li class="md-movie__rating">
                    <i class="bi bi-brightness-high"></i>
                    <span class=""><%= data.sec3[i].averageRate%></span>
                  </li>
                  <li>
                    <h4 class="movie-title__large"><%= data.sec3[i]['CommentMovie.title'] %></h4>
                  </li>
                </ul>
              </div>
            </div>
            <% } %>
          </div>
        </div>
        <div class="arrow-box swiper-button-prev__bt">
          <i class="fa-solid fa-chevron-left arrow-icon left-arrow"></i>
        </div>
        <div class="arrow-box swiper-button-next__bt">
          <i class="fa-solid fa-chevron-right arrow-icon right-arrow"></i>
        </div>
      </section>
    </div>

    <div class="footer">
      <strong>주식회사</strong> 무비캐스터 <strong>대표</strong> 4FLEX 서울특별시 용산구 청파로
      109(나진전자월드상가) 3층 <br />
      <strong>사업자 등록 번호</strong> 595-95-0099 <br />
      © 2023 by MovieCaster, Inc. All rights reserved. <br />
    </div>

    <script>
      // section 1 : 슬라이드 3초 주기 무한 반복
      document.addEventListener('DOMContentLoaded', () => {
      const boxOfficePosters = document.querySelectorAll('.box-office-poster img');
      const ranking = document.querySelectorAll('.box-office-rank');
      
      const data = <%- JSON.stringify(data.sec1) %>;
      let currentIdx = 0;

      setInterval(() => {
        if (data && data.length > 0) {
          currentIdx = currentIdx % data.length;

          for (let i = 0; i < boxOfficePosters.length; i++) {
            const posterPath = data[currentIdx].poster_path;

            boxOfficePosters[i].src = `https://image.tmdb.org/t/p/w154/${posterPath}`;
            ranking[i].innerHTML = `${(currentIdx % data.length) + 1}`;
            currentIdx++;
          }
        }
      }, 3000);
    });

      
      // API로 영화 정보 받아오기 : Box Office, Top rated, Upcoming
      // mainApiPosters();

      // function mainApiPosters() {
      //   // API key
      //   axios({
      //     method: 'post',
      //     url: '/',
      //   }).then((res) => {
      //     const key = res.data;

      //     const endpoint = 'https://api.themoviedb.org/3/movie';


    //       // Upcoming
    //       axios.get(`${endpoint}/upcoming?api_key=${key}&language=ko-KR`).then((res) => {
    //         const movieData = res.data.results;
    //         const posterPath = movieData.map((movie) => movie.poster_path);
    //         const posterTitle = movieData.map((movie) => movie.title);

    //         const mdMoivePosters = document.querySelectorAll('.md-movie__poster img');
    //         mdMoivePosters.forEach((poster, index) => {
    //           poster.src = `https://image.tmdb.org/t/p/w200/${posterPath[index]}`;
    //         });

    //         const upcomingMovies = document.querySelectorAll('.movie-title__large');
    //         upcomingMovies.forEach((title, index) => {
    //           title.textContent = `${posterTitle[index]}`;
    //         });
    //       });
    //     });
    //   }
    // </script>

    <script>
      function clickLike(thisIcon) {
        thisIcon.classList.toggle('heart-active');
      }
    </script>

    <!-- swiper.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- best-section swiper -->
    <script>
      const bestSwiper = new Swiper('.best-section-swiper', {
        slidesPerView: 5, 
        spaceBetween: 20,
        navigation: {
          prevEl: '.swiper-button-prev',
          nextEl: '.swiper-button-next',
        },
      });
</script>
    </script>

    <!-- md-section swiper -->
    <script>
      const mdSwiper = new Swiper('.md-section-swiper', {
        slidesPerView: 5,
        spaceBetween: 20,
        navigation: {
          prevEl: '.swiper-button-prev__bt',
          nextEl: '.swiper-button-next__bt',
        },
        // breakpoints: {
        // 320: {
        // slidesPerView: 2,
        // spaceBetween: 20
        // },
        // 480: {
        // slidesPerView: 3,
        // spaceBetween: 30
        // },
        // 1000: {
        // slidesPerView: 4,
        // spaceBetween: 40
        // }
        // }
      });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
  const posters = document.querySelectorAll('.box-office-poster img');
  posters.forEach((poster, index) => {
    poster.addEventListener('click', () => {
      const movieidx = index; // 클릭한 포스터의 인덱스를 movieidx로 사용

      axios.get(`/detail/getMovieInfo/${movieidx}`)
        .then((response) => {
          const movieInfo = encodeURIComponent(JSON.stringify(response.data)); // 영화 정보를 URL에서 사용할 수 있도록 인코딩
          // 영화 정보를 URL에 추가하여 상세 페이지로 이동
          window.location.href = `/detail?movieidx=${movieidx}&movieInfo=${movieInfo}`;
        })
        .catch((error) => {
          console.error('Error fetching movie information:', error);
        });
    });
  });
});
    </script>
  </body>
</html>
